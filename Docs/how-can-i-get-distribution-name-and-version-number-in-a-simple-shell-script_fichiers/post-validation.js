'use strict';StackExchange.postValidation=function(){function t(b,a,d){var c=b.find('input[type="submit"]:visible'),e=c.length&&c.is(":enabled");e&&c.attr("disabled",!0);y(b);z(b,a,d);A(b);B(b);C(b);var f=function(){1!=a||b.find(n).length?(D(b),e&&c.attr("disabled",!1)):setTimeout(f,250)};f()}function u(){for(var b=0;b<j.length;b++)clearTimeout(j[b]);j=[]}function y(b){var a=b.find(o);a.length&&a.blur(function(){j.push(setTimeout(function(){var d=a.val(),c=$.trim(d);if(0==c.length)f(b,a);else{var e=
a.data("min-length");e&&c.length<e?g(a,["Title must be at least "+e+" characters."],i()):(e=a.data("max-length"))&&c.length>e?g(a,["Title cannot be longer than "+e+" characters."],i()):$.ajax({type:"POST",url:"/posts/validate-title",data:{title:d},success:function(c){c.success?f(b,a):g(a,c.errors.Title,i())},error:function(){f(b,a)}})}},m))})}function z(b,a,d){var c=b.find(p);c.length&&c.blur(function(){j.push(setTimeout(function(){var e=c.val(),k=$.trim(e);0==k.length?f(b,c):5==a?(e=c.data("min-length"))&&
k.length<e?g(c,["Wiki Body must be at least "+e+" characters. You entered "+k.length+"."],i()):f(b,c):(1==a||2==a)&&$.ajax({type:"POST",url:"/posts/validate-body",data:{body:e,oldBody:c.prop("defaultValue"),isQuestion:1==a,isSuggestedEdit:d},success:function(a){a.success?f(b,c):g(c,a.errors.Body,i())},error:function(){f(b,c)}})},m))})}function D(b){var a=b.find(n);if(a.length){var d=a.parent().find("input#tagnames");d.blur(function(){j.push(setTimeout(function(){var c=d.val();0==$.trim(c).length?
f(b,a):$.ajax({type:"POST",url:"/posts/validate-tags",data:{tags:c,oldTags:d.prop("defaultValue")},success:function(c){c.success?f(b,a):g(a,c.errors.Tags,i())},error:function(){f(b,a)}})},m))})}}function A(b){var a=b.find(q);a.length&&a.blur(function(){j.push(setTimeout(function(){var d=a.val(),d=$.trim(d);if(0==d.length)f(b,a);else{var c=a.data("min-length");c&&d.length<c?g(a,["Your edit summary must be at least "+c+" characters."],i()):(c=a.data("max-length"))&&d.length>c?g(a,["Your edit summary cannot be longer than "+
c+" characters."],i()):f(b,a)}},m))})}function B(b){var a=b.find(r);a.length&&a.blur(function(){j.push(setTimeout(function(){var d=a.val(),d=$.trim(d);if(0==d.length)f(b,a);else{var c=a.data("min-length");c&&d.length<c?g(a,["Wiki Excerpt must be at least "+c+" characters; you entered "+d.length+"."],i()):(c=a.data("max-length"))&&d.length>c?g(a,["Wiki Excerpt cannot be longer than "+c+" characters; you entered "+d.length+"."],i()):f(b,a)}},m))})}function C(b){var a=b.find(s);a.length&&a.blur(function(){j.push(setTimeout(function(){var d=
a.val();0==$.trim(d).length?f(b,a):/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,20}$/i.test(d)?f(b,a):g(a,["This email does not appear to be valid."],v())},m))})}function i(){var b=$("#sidebar, .sidebar").first().width()||270;return{position:{my:"left top",at:"right center"},css:{"max-width":b,"min-width":b},closeOthers:!1}}function v(){return{position:{my:"left top",at:"right center"},css:{"min-width":$("#sidebar, .sidebar").first().width()||270},closeOthers:!1}}function w(b,a,d,c){if(b){var e=function(){var d=
0;g(a.find(o),b.Title,i())?d++:f(a,a.find(o));g(a.find(p),b.Body,i())?d++:f(a,a.find(p));g(a.find(n),b.Tags,i())?d++:f(a,a.find(n));g(a.find(q),b.EditComment,i())?d++:f(a,a.find(q));g(a.find(r),b.Excerpt,i())?d++:f(a,a.find(r));g(a.find(s),b.Email,v())?d++:f(a,a.find(s));var e=a.find(".general-error"),k=b.General&&0<b.General.length;k||0<d?(e.length||(a.find('input[type="submit"]:visible').before('<div class="general-error-container"><div class="general-error"></div><br class="cbt" /></div>'),e=a.find(".general-error")),
k?g(e,b.General,{position:"inline",css:{"float":"left","margin-bottom":"10px"},closeOthers:!1,dismissable:!1}):(f(a,e),e.text("Your "+c+" couldn't be submitted. Please see the "+(1==d?"error":"errors")+" above."))):a.find(".general-error-container").remove();var h;x()&&($("#sidebar").animate({opacity:0.4},500),h=setInterval(function(){x()||($("#sidebar").animate({opacity:1},500),clearInterval(h))},500));var l;a.find(".validation-error").each(function(){var a=$(this).offset().top;if(!l||a<l)l=a});
d=function(){};l&&(e=$(".review-bar").length,l=Math.max(0,l-(e?125:30)),$("html, body").animate({scrollTop:l},d))},k=function(){1!=d||a.find(n).length?e():setTimeout(k,250)};k()}}function g(b,a,d){if(!a||0==a.length||!b.length)return!1;if((a=1==a.length?a[0]:"<ul><li>"+a.join("</li><li>")+"</li></ul>")&&0<a.length){var c=b.data("error-popup");if(c&&c.is(":visible")){if(b.data("error-message")==a)return!0;c.fadeOutAndRemove()}d=StackExchange.helpers.showMessage(b,a,d);d.find("a").attr("target","_blank");
b.addClass("validation-error");b.data("error-popup",d);b.data("error-message",a);d.click(u);return!0}return!1}function f(b,a){if(!a||0==a.length)return!1;var d=a.data("error-popup");d&&d.is(":visible")&&d.fadeOutAndRemove();a.removeClass("validation-error");a.removeData("error-popup");a.removeData("error-message");b.find(".validation-error").length||b.find(".general-error-container").remove();return!0}function x(){var b=!1,a=$("#sidebar, .sidebar").first();if(!a.length)return!1;var d=a.offset().left;
$(".message").each(function(){var a=$(this);if(a.offset().left+a.outerWidth()>d)return b=!0,!1});return b}var o="input#title",p="textarea.wmd-input:first",n=".tag-editor",q="input[id^=edit-comment]",r="textarea#excerpt",s="input#m-address",j=[],m=250;return{initOnBlur:t,initOnBlurAndSubmit:function(b,a,d,c,e){t(b,a,c);var f,g=function(c){c.success?e?e(c):(f=!0,window.location=c.redirectTo):c.captchaHtml?StackExchange.captcha.init(c.captchaHtml,g):c.errors?w(c.errors,b,a,d):b.find('input[type="submit"]:visible').parent().showErrorMessage(c.message)};
b.submit(function(){if(b.find("#answer-from-ask").is(":checked"))return!0;u();StackExchange.navPrevention&&StackExchange.navPrevention.stop();b.find('input[type="submit"]:visible').parent().addSpinner();StackExchange.helpers.disableSubmitButton(b);$.ajax({type:"POST",dataType:"json",data:b.serialize(),url:b.attr("action"),success:g,error:function(){b.find('input[type="submit"]:visible').parent().showErrorMessage("An error occurred submitting the "+d+".")},complete:function(){StackExchange.helpers.removeSpinner();
f||StackExchange.helpers.enableSubmitButton(b)}});return!1})},showErrors:function(b,a,d,c){function e(a,b,c,d){if(b&&0!=b.length&&a.length&&(b=1==b.length?b[0]:"<ul><li>"+b.join("</li><li>")+"</li></ul>")&&0<b.length){var e=StackExchange.helpers.showMessage(a,b,d),h;a.is('input[type="text"]')||a.is("textarea")?h=a:a.is(".tags-error-anchor")&&(h=a.find('input[type="text"], textarea').first());h&&h.change(function(){e.fadeOutAndRemove()});a=a.offset().top;if(!f||a<f)f=a;c?i=!0:g=!0;j++}}if(b){a.find(".message").remove();
a.find(".general-errors-container").empty();var f,g,i,j=0,h=$("#sidebar, .sidebar").first().width()||270;e(a.find(".general-errors-container"),b.General,!0,{position:"inline",css:{"float":"left","margin-bottom":"10px"},closeOthers:!1,dismissable:!1});e(a.find("input#title"),b.Title,!1,{position:{my:"left top",at:"right center"},css:{"max-width":h,"min-width":h},closeOthers:!1});e(a.find("textarea.wmd-input"),b.Body,!1,{position:{my:"left top",at:"right center"},css:{"max-width":h,"min-width":h},closeOthers:!1});
e(a.find(".tags-error-anchor"),b.Tags,!1,{position:{my:"left top",at:"right center"},css:{"max-width":h,"min-width":h},closeOthers:!1});e(a.find("input[id^=edit-comment]"),b.EditComment,!1,{position:{my:"left top",at:"right center"},css:{"max-width":h,"min-width":h},closeOthers:!1});e(a.find("textarea#excerpt"),b.Excerpt,!1,{position:{my:"left top",at:"right center"},css:{"max-width":h,"min-width":h},closeOthers:!1});e(a.find("#m-address"),b.Email,!1,{position:{my:"left top",at:"right center"},css:{"min-width":h},
closeOthers:!1});g&&!i&&d&&0<d.length&&(b="Your "+d+" couldn't be submitted. Please see the "+(1==j?"error":"errors")+" above.",a.find(".general-errors-container").append('<div class="submit-error">'+b+"</div>"));f&&(f=Math.max(0,f-(c?100:30)),$("html, body").animate({scrollTop:f}))}},showErrorsAfterSubmission:w}}();
